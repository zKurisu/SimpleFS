# Hello ğŸ”¥
è¯¥ä»“åº“ç”¨ä½œ "UNIX ç¯å¢ƒé«˜çº§ç¼–ç¨‹" çš„è¯¾ç¨‹å¤§ä½œä¸š, æœ‰ä¸¤ä¸ª Task, ä¸€ä¸ªæ˜¯ç¼–å†™ disk simulator, å¦ä¸€ä¸ªæ˜¯å®ç° filesystem çš„éƒ¨åˆ†åŠŸèƒ½. åç»­æœ‰æ—¶é—´å¯ä»¥æ‰©å±•åŠŸèƒ½, æˆ‘ä¸»è¦å‚è€ƒ Youtube ä¸Š Dr Jonas Birch å…³äºæ–‡ä»¶ç³»ç»Ÿçš„é¡¹ç›®: [Filesystem from scratch](https://www.youtube.com/watch?v=d8flm9qT5O0).

![](.img/zelda.png)

# TODO
è®¡åˆ’å†…å®¹, è¿™é‡Œåˆ—å‡ºä¸å®Œå…¨ç‰ˆæœ¬, åç»­æ›´æ–°:
- âœ… `dattach`, åˆå§‹åŒ– disk ç»“æ„ä½“, è·å– low level æ–‡ä»¶æè¿°ç¬¦
- âœ… `ddetach`, é‡Šæ”¾ disk èµ„æº
- âœ… `dshow`, æ‰“å° disk ä¿¡æ¯
- âœ… `dread`, è¯»å–ä¸€ä¸ª block
- âœ… `dwrite`, å†™å…¥ä¸€ä¸ª block
- âœ… `dreads`, è¯»å–ä¸€ç»„ blocks
- âœ… `dwrites`, å†™å…¥ä¸€ç»„ blocks
- âœ… `bm_getbit`, è·å–æŸä½
- âœ… `bm_setbit`, è®¾ç½®æŸä½
- âœ… `bm_unsetbit`, å–æ¶ˆæŸä½
- âœ… `bm_clearmap`, æ¸…ç†æ•´ä¸ª bitmap
- âœ… `get_inode_per_block`, è·å–æ¯ä¸ª block èƒ½å®¹çº³çš„ inode èŠ‚ç‚¹æ•°é‡
- âœ… `bl_create`, åˆ›å»ºä¸€ä¸ª block
- âœ… `bl_set_data`, è®¾ç½® block çš„ data å­—æ®µ
- âœ… `bl_get_data`, è·å– block çš„ data å­—æ®µ
- âœ… `bl_alloc`, æŸ¥é˜…å¹¶æ›´æ–° block bitmap, åˆ†é…ä¸€ä¸ªå¯ç”¨çš„ block number (ç½®ä¸º 1 è¡¨ç¤ºå·²å ç”¨)
- âœ… `bl_free`, æŸ¥é˜…å¹¶æ›´æ–° block bitmap, é‡Šæ”¾ä¸€ä¸ª block number (ç½®ä¸º 0 è¡¨ç¤ºæœªå ç”¨)
- âœ… `fs_format`, ç”¨ fs ä¸­å®šä¹‰çš„ä¸€äº›å¸¸é‡åˆå§‹åŒ– disk (æ“ä½œç£ç›˜æ–‡ä»¶)
- âœ… `fs_mount`, è¯»å– disk æ–‡ä»¶ä¿¡æ¯, åˆå§‹åŒ– filesystem ç»“æ„ä½“
- âœ… `fs_unmount`, é‡Šæ”¾ filesystem ç»“æ„ä½“
- âœ… `fs_show`, æ‰“å° filesystem ç»“æ„ä½“ä¿¡æ¯
- âœ… `ino_init`, æ¸…é›¶ä¸€ä¸ª inode
- âœ… `ino_alloc`, æŸ¥é˜…å¹¶æ›´æ–° inode bitmap, åˆ†é…ä¸€ä¸ªå¯ç”¨çš„ inode number (ç½®ä¸º 1 è¡¨ç¤ºå·²å ç”¨)
- âœ… `ino_free`, æŸ¥é˜…å¹¶æ›´æ–° inode bitmap, é‡Šæ”¾ä¸€ä¸ªå¯ç”¨çš„ inode number (ç½®ä¸º 0 è¡¨ç¤ºæœªå ç”¨)
- âœ… `ino_read`, ç”¨ inode number ä»ç£ç›˜è¯»å–ä¸€ä¸ª inode ä¿¡æ¯
- âœ… `ino_write`, å‘ç£ç›˜å†™å…¥ä¸€ä¸ª inode ä¿¡æ¯åˆ°æŒ‡å®š inode number
- âœ… `ino_alloc_block_at`, å‘ `direct_blocks` æˆ– `single_indirect` ä¸­åˆ†é…å¯ç”¨çš„ block number
- âœ… `ino_get_block_at`, ä» `direct_blocks` æˆ– `single_indirect` ä¸­è¯»å–ä¸€ä¸ª block number
- âœ… `ino_free_block_at`, ä» `direct_blocks` æˆ– `single_indirect` ä¸­é‡Šæ”¾ block number
- âœ… `ino_free_all_blocks`, ä» `direct_blocks` æˆ– `single_indirect` ä¸­é‡Šæ”¾æ‰€æœ‰ block number
- âœ… `ino_show`, æ‰“å° inode ä¿¡æ¯
- âœ… `ino_is_valid`, æ£€æŸ¥æ˜¯å¦ä¿å­˜æœ‰ inode number, ç±»å‹æ˜¯å¦æ­£ç¡®
- âœ… `ino_get_block_count`, æŸ¥çœ‹ inode å·²åˆ†é…å¤šå°‘ blocks 
- âœ… `ino_get_max_block_offset`, è·å–ä¸€ä¸ª inode èƒ½ç®¡ç†çš„ blocks çš„æœ€å¤§æ•°ç›®
- âœ… `dirent_check_valid_name`, æ£€æŸ¥æ–‡ä»¶åæ˜¯å¦ç¬¦åˆè¦æ±‚, è¿™é‡Œæ˜¯ `[A-Za-z0-9.-_]`
- âœ… `get_dirent_per_block`, è·å–ä¸€ä¸ª block èƒ½å­˜å‚¨çš„ direntry æ•°é‡
- âœ… `dir_lookup`, ä»ä¸€ä¸ª directory inode é€šè¿‡ name æŸ¥æ‰¾å¯¹åº”çš„ inode number
- âœ… `dir_add`, å‘ä¸€ä¸ª directory inode ä¸­æ·»åŠ ä¸€ä¸ª directory entry
- âœ… `dir_remove`, ä»ä¸€ä¸ª directory inode ä¸­ç§»é™¤ä¸€ä¸ª directory entry
- âœ… `dir_list`, åˆ—å‡ºä¸€ä¸ª directory inode ä¸­çš„æ‰€æœ‰ directory entries
- âœ… `dir_is_empty`, directory æ˜¯å¦ä¸ºç©º (å¯ä»¥æœ‰ `.` å’Œ `..`)
- âœ… `dir_valid_name`, ç›®å½•åæ˜¯å¦åŒ…å«é”™è¯¯å­—ç¬¦
- âœ… `dir_create_root`, åˆ›å»ºæ ¹ç›®å½•,  æ·»åŠ ä¸¤ä¸ª direntry: `.` å’Œ `..` éƒ½æŒ‡å‘è‡ªèº«
- âœ… `dir_create`, åˆ›å»ºä¸€ä¸ªæ™®é€šç›®å½•, æ·»åŠ ä¸¤ä¸ª direntry: `.` æŒ‡å‘è‡ªèº«, `..` æŒ‡å‘çˆ¶ç›®å½•
- âœ… `dir_delete_empty`, åˆ é™¤ä¸€ä¸ªç©ºç›®å½• (åªæœ‰ `.` å’Œ `..` çš„ç›®å½•ç§°ç©ºç›®å½•)
- âœ… `dir_show`, æ‰“å° directory ä¿¡æ¯


# Task1
- ç›®æ ‡: å®Œæˆç”¨æˆ·æ€ç¯å¢ƒä¸‹çš„ç£ç›˜æ¨¡æ‹ŸåŠŸèƒ½, æä¾›ç£ç›˜åŸºæœ¬ä¿¡æ¯æŸ¥è¯¢ä¸æ ¼å¼åŒ–åŠŸèƒ½ã€‚
- å®ç°çº¦æŸï¼šåˆ©ç”¨ä¸€ä¸ªå¤§æ–‡ä»¶æ¥æ¨¡æ‹Ÿç£ç›˜å—è®¾å¤‡ï¼ŒåŸºäºå›ºå®šåˆ†ç‰‡å¤§å°å®ç°æ–‡ä»¶ç³»ç»Ÿçš„è¶…çº§å—åŒºã€inodeèŠ‚ç‚¹åŒºã€æ•°æ®åˆ†ç‰‡åŒºçš„ç®¡ç†ï¼Œå…·å¤‡ç£ç›˜æ ¼å¼åŒ–ã€æ–‡ä»¶ç³»ç»ŸæŸ¥è¯¢ï¼ˆå¦‚ï¼šfdisk k - lï¼‰åŠŸèƒ½ï¼Œæ”¯æŒæ–‡ä»¶çš„inodeèŠ‚ç‚¹å’Œå¯¹åº”æ•°æ®åˆ†ç‰‡çš„åˆ†é…ã€å›æ”¶ã€‚
- æäº¤å†…å®¹ï¼šå¯ç¼–è¯‘çš„æºç ï¼Œå¯åœ¨linuxç¯å¢ƒä¸­è¿è¡Œçš„ç¨‹åºï¼›è®¾è®¡æ–‡æ¡£ï¼ˆåŒ…æ‹¬æ¨¡å—æ¡†æ¶è®¾è®¡ï¼Œé‡è¦æµç¨‹å›¾ï¼‰ï¼Œæ ¸å¿ƒæ•°æ®ç»“æ„ï¼Œè¿è¡Œæ—¶æˆªå›¾ï¼ˆæ“ä½œç›¸å…³ç»“æœï¼‰ã€‚

# Task2
- ç›®æ ‡ï¼šå®Œæ•´æ–‡ä»¶ç³»ç»Ÿå‘½ä»¤è¡Œæ“ä½œæ¥å£ï¼Œå¹¶å½¢æˆå‘½ä»¤ä»»åŠ¡ä¸‹å‘ï¼Œä¸ä½œä¸š1çš„æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨å¼•æ“é›†æˆï¼Œæ„å»ºå®Œæ•´çš„æ¨¡æ‹Ÿæ–‡ä»¶ç³»ç»Ÿã€‚
- å½¢å¼è¦æ±‚ï¼šåŸºäºC/C++ï¼Œæä¾›ä¸Šè¿°æ¥å£ï¼Œå¹¶ç¼–è¯‘ä¸ºä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºã€‚
- å®ç°çº¦æŸï¼š
  1ï¼‰éœ€æ”¯æŒå¤šçº¿ç¨‹ç¯å¢ƒï¼Œé‡‡ç”¨å•ç”Ÿäº§è€…å¤šæ¶ˆè´¹è€…æ¨¡å‹ï¼›å®Œæˆlsï¼Œcatï¼Œrmï¼Œcopyå‡ ä¸ªå…¸å‹å‘½ä»¤ï¼ŒæŒç»­è¯»å†™å‹åŠ›æµ‹è¯•ï¼Œè¿è¡Œæ—¶é—´ä¸ä½äº12å°æ—¶ï¼Œè¯»å†™æ–‡ä»¶ä¸ä½äº50ä¸ªï¼Œè§‚å¯ŸCPUï¼Œå†…å­˜ï¼Œç£ç›˜å¼€é”€ï¼Œå¹¶å°†å‹æµ‹åˆ†æè¾“å‡ºåˆ°æŠ¥å‘Šä¸­ã€‚
- æäº¤å†…å®¹ï¼šå¯ç¼–è¯‘çš„æºç ï¼ˆå­˜å‚¨å¼•æ“å’Œæµ‹è¯•ç¨‹åºæºä»£ç ï¼‰ï¼Œå¯æ‰§è¡Œæ–‡ä»¶å’ŒSOåº“æ–‡ä»¶ï¼›è®¾è®¡æ–‡æ¡£ï¼ˆåŒ…æ‹¬æ¨¡å—æ¡†æ¶è®¾è®¡ï¼Œé‡è¦æµç¨‹å›¾ï¼‰ï¼Œæ ¸å¿ƒæ•°æ®ç»“æ„ï¼Œè¿è¡Œæ—¶æˆªå›¾ï¼ˆæ“ä½œç›¸å…³ç»“æœï¼‰ã€‚
